generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}


model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  password     String
  name         String?
  phone        String?
  cedula       String?
  fiatBalance  Float         @default(0.0)
  cacaoBalance Float         @default(0.0)
  // Datos bancarios personales del usuario
  bankCountry  String?
  bankName     String?
  bankAccount  String?
  bankHolder   String?
  bankType     String?       // "corriente" | "ahorro"
  transactions Transaction[]
  role         String        @default("user") // "admin" | "cajero" | "oficinista" | "user"
  status       String        @default("active") // "active" | "blocked"
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model BankOption {
  id            Int           @id @default(autoincrement())
  country       String
  bankName      String
  accountHolder String
  accountNumber String
  accountType   String?
  notes         String?
  isActive      Boolean       @default(true)
  transactions  Transaction[]
  createdAt     DateTime      @default(now())
}

model PaymentMethod {
  id          Int    @id @default(autoincrement())
  code        String @unique // "BANK" | "OFFICE"
  label       String
  description String?
  isActive    Boolean @default(true)
}

model Transaction {
  id           Int         @id @default(autoincrement())
  userId       Int
  user         User        @relation(fields: [userId], references: [id])
  type         String      // "DEPOSIT_CACAO" | "DEPOSIT_USD" | "WITHDRAW_CACAO" | "WITHDRAW_USD" | "CONVERT_CACAO_TO_USD" | "CONVERT_USD_TO_CACAO"
  amount       Float       // Cantidad principal (gramos de cacao o USD según tipo)
  amountUSD    Float?      // Equivalente en USD (para conversiones/depósitos)
  amountCacao  Float?      // Equivalente en cacao (para conversiones/depósitos)
  priceAt      Float?      // Precio del cacao al momento (USD/g)
  method       String?     // "BANK" | "OFFICE"
  bankOptionId Int?
  bankOption   BankOption? @relation(fields: [bankOptionId], references: [id])
  status       String      @default("PENDING") // "PENDING" | "COMPLETED" | "REJECTED"
  notes        String?
  createdAt    DateTime    @default(now())
}

model SystemConfig {
  id                  Int      @id @default(1)
  buyPrice            Float    @default(3.50)  // Precio al que compramos cacao (USD/g)
  sellPrice           Float    @default(4.00)  // Precio al que vendemos cacao (USD/g)
  maintenanceFee      Float    @default(1.00)  // Tasa de mantenimiento mensual (USD)
  networkFee          Float    @default(0.10)  // Tasa de uso de red por transacción (USD)
  lastZilaPrice       Float?                   // Último precio de referencia de Zila Labs
  updatedAt           DateTime @updatedAt
}
